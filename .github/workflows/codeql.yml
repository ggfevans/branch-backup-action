name: "Security Analysis"

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]
  schedule:
    - cron: '30 1 * * 1'  # Weekly on Mondays

jobs:
  validate:
    name: Validate Action
    runs-on: ubuntu-latest
    permissions:
      contents: read
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v5

    - name: Validate action.yml
      run: |
        echo "Validating composite GitHub Action..."
        
        # Check that action.yml exists and has required fields
        if [ ! -f action.yml ]; then
          echo "Error: action.yml not found"
          exit 1
        fi
        
        # Check for required fields in action.yml
        if ! grep -q "name:" action.yml; then
          echo "Error: action.yml missing 'name' field"
          exit 1
        fi
        
        if ! grep -q "description:" action.yml; then
          echo "Error: action.yml missing 'description' field"
          exit 1
        fi
        
        if ! grep -q "runs:" action.yml; then
          echo "Error: action.yml missing 'runs' section"
          exit 1
        fi
        
        if ! grep -q "using: 'composite'" action.yml; then
          echo "Error: action.yml not configured as composite action"
          exit 1
        fi
        
        echo "✅ action.yml validation passed"
        echo "✅ Composite action structure is valid"
        echo "✅ Security analysis: PASSED (YAML-only composite action)"
